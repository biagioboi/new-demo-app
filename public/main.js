(()=>{const e=document.querySelector("#searchBar"),o=document.querySelector("#getBtn"),t=document.querySelector("#responseArea");let n,a,s,l=new URLSearchParams(location.search);async function i(e,o){let t={method:"GET",headers:{vp:o,"Cache-Control":"no-cache"}},n=await fetch(e,t);return console.log(`Sent second request: ${JSON.stringify(t)}`),$(".label-loader").css("display","none").html("Server accepted the proof, showing the content").fadeIn(),$(".loader-almost-load").css("display","none").addClass("loader-loaded").fadeIn(),await n.text()}o.onclick=function(){n="theapp",a="did:key:z6MkjiobbuCnEED7VRkNjWtVmPFmPEGULAG1AgvWMxeXMreY",s="did:key:z6Mkw4VsQTL36g5t4AA27M38ZgpEJE6ESas468vhZNhZJqjA",async function(){let o=e.value;if(l.get("vp")){let e=l.get("vp");console.log("Sending request for the resource with a VP...");let n=await i(o,e);console.log(n),t.innerHTML=n}else{console.log("Sending first request for the resource...");let e=await fetch(o,{method:"POST",headers:{vc:"true"},body:JSON.stringify({user:"did:key:z6MkjiobbuCnEED7VRkNjWtVmPFmPEGULAG1AgvWMxeXMreY",app:"theapp",vcissuer:"did:key:z6Mkw4VsQTL36g5t4AA27M38ZgpEJE6ESas468vhZNhZJqjA"})}),n=await e.json();console.log(n),t.innerHTML=JSON.stringify(n);let a,s,l=n;try{a=l.VerifiablePresentation.challenge,s=l.VerifiablePresentation.domain}catch(e){return void console.log("No nonce or domain received in response")}$(".label-loader").html("Copy the code and accept the request on your mobile phone").fadeIn(),$(".loader").fadeIn(),window.setTimeout((async()=>{let e;$.ajax({method:"GET",url:"http://localhost:8080/generateInvitation",success:async function(n){console.log(n),e=n.connectionId,$("#invitation").html(n.url),$("#invitation").append('<img src="'+n.qrcode+'">'),$.ajax({method:"POST",url:"http://localhost:8080/requestUserCredential",data:{connectionId:e,challenge:l.VerifiablePresentation.challenge,domain:l.VerifiablePresentation.domain},success:async function(e){$("#invitation").html(""),$(".label-loader").css("display","none").html("Proof accepted, sending the request to the server").fadeIn(),$(".loader").css("display","none").addClass("loader-almost-load").fadeIn(),$("#responseVP").html(JSON.stringify(e,void 0,2));let n=await i(o,e);t.innerHTML=n,window.setTimeout((()=>{$(".loader-loaded").css("display","none")}),500)}})}})}),1e3)}}()}})();