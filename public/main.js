(()=>{const e=document.querySelector("#searchBar"),t=document.querySelector("#getBtn"),n=document.querySelector("#responseArea");let i,o,r,a=new URLSearchParams(location.search);async function s(e,t){let n={method:"GET",headers:{vp:t,"Cache-Control":"no-cache"}},i=await fetch(e,n);return console.log(`Sent second request: ${JSON.stringify(n)}`),$(".label-loader").css("display","none").html("Server accepted the proof, showing the content").fadeIn(),$(".loader-almost-load").css("display","none").addClass("loader-loaded").fadeIn(),await i.text()}function l(e){return(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,(function(e){var t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),'<span class="'+t+'">'+e+"</span>"}))}t.onclick=function(){o="did:web:bboi.solidcommunity.net:public",r="did:web:secureissuer.solidcommunity.net:public",i="did:web:secureapp.solidcommunity.net:public",async function(){let t=e.value;if(a.get("vp")){let e=a.get("vp");console.log("Sending request for the resource with a VP...");let i=await s(t,e);console.log(i),n.innerHTML=i}else{console.log("Sending first request for the resource...");let e=await fetch(t,{method:"POST",headers:{vc:"true"},body:JSON.stringify({VPCompliant:!1,agent:"did:web:bboi.solidcommunity.net:public",client:"did:web:secureapp.solidcommunity.net:public",issuer:"did:web:secureissuer.solidcommunity.net:public"})}),i=await e.json();console.log(i),n.innerHTML=l(JSON.stringify(i,null,2));let o,r=i;void 0!==r.VerifiablePresentation?o={challenge:r.VerifiablePresentation.challenge,domain:r.VerifiablePresentation.domain,owner:r.VerifiablePresentation.query.credentialQuery.owner.id,issuer:r.VerifiablePresentation.query.credentialQuery.issuer.id,creator:r.VerifiablePresentation.query.credentialQuery.creator.id,client:r.VerifiablePresentation.query.credentialQuery.client.id,agent:r.VerifiablePresentation.query.credentialQuery.agent.id}:(o={challenge:r.options.challenge,domain:r.options.domain,target:r.presentation_definition.requestACP.target,owner:r.presentation_definition.requestACP.owner,issuer:r.presentation_definition.requestACP.issuer,creator:r.presentation_definition.requestACP.creator,client:r.presentation_definition.requestACP.client,agent:r.presentation_definition.requestACP.agent,input_descriptors:JSON.stringify(r.presentation_definition.input_descriptors)},"VerifiablePresentationRequest"===r.type[0]&&(o.vpr=JSON.stringify(r))),console.log(o),$(".label-loader").html("Copy the code and accept the request on your mobile phone").fadeIn(),$(".loader").fadeIn(),t===o.target?window.setTimeout((async()=>{$.ajax({method:"GET",url:"http://localhost:8080/generateInvitation",success:async function(e){o.connectionId=e.connectionId,$("#invitation").html(e.url),$("#invitation").append('<img src="'+e.qrcode+'">'),$.ajax({method:"POST",url:"http://localhost:8080/requestUserCredential",data:o,success:async function(e){$("#invitation").html(""),$(".label-loader").css("display","none").html("Proof accepted, sending the request to the server").fadeIn(),$(".loader").css("display","none").addClass("loader-almost-load").fadeIn(),$("#responseVP").html(l(JSON.stringify(e,void 0,2)));let i=await s(t,JSON.stringify(e));n.innerHTML=i,window.setTimeout((()=>{$(".loader-loaded").css("display","none")}),500)}})}})}),1e3):alert("Server is not sending the right domain, they don't match.")}}()}})();