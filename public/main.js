(()=>{const e=document.querySelector("#searchBar"),n=document.querySelector("#getBtn"),o=document.querySelector("#responseArea");let t,a,s,i=new URLSearchParams(location.search);async function l(e,n){let o={method:"GET",headers:{vp:n,"Cache-Control":"no-cache"}},t=await fetch(e,o);return console.log(`Sent second request: ${JSON.stringify(o)}`),$(".label-loader").css("display","none").html("Server accepted the proof, showing the content").fadeIn(),$(".loader-almost-load").css("display","none").addClass("loader-loaded").fadeIn(),await t.text()}n.onclick=function(){t="theapp",a="did:key:z6MkjiobbuCnEED7VRkNjWtVmPFmPEGULAG1AgvWMxeXMreY",s="did:key:z6Mkw4VsQTL36g5t4AA27M38ZgpEJE6ESas468vhZNhZJqjA",async function(){let n=e.value;if(i.get("vp")){let e=i.get("vp");console.log("Sending request for the resource with a VP...");let t=await l(n,e);console.log(t),o.innerHTML=t}else{console.log("Sending first request for the resource...");let e=await fetch(n,{method:"POST",headers:{vc:"true"},body:JSON.stringify({user:"did:key:z6MkjiobbuCnEED7VRkNjWtVmPFmPEGULAG1AgvWMxeXMreY",app:"theapp",vcissuer:"did:key:z6Mkw4VsQTL36g5t4AA27M38ZgpEJE6ESas468vhZNhZJqjA"})}),t=await e.json();console.log(t),o.innerHTML=JSON.stringify(t);let a,s,i=t;try{a=i.VerifiablePresentation.challenge,s=i.VerifiablePresentation.domain}catch(e){return void console.log("No nonce or domain received in response")}$(".label-loader").html("Copy the code and accept the request on your mobile phone").fadeIn(),$(".loader").fadeIn(),i.VerifiablePresentation.domain,window.setTimeout((async()=>{let e;$.ajax({method:"GET",url:"http://localhost:8080/generateInvitation",success:async function(t){console.log(t),e=t.connectionId,$("#invitation").html(t.url),$("#invitation").append('<img src="'+t.qrcode+'">'),$.ajax({method:"POST",url:"http://localhost:8080/requestUserCredential",data:{connectionId:e,challenge:i.VerifiablePresentation.challenge,domain:i.VerifiablePresentation.domain},success:async function(e){$("#invitation").html(""),$(".label-loader").css("display","none").html("Proof accepted, sending the request to the server").fadeIn(),$(".loader").css("display","none").addClass("loader-almost-load").fadeIn(),$("#responseVP").html(JSON.stringify(e,void 0,2));let t=await l(n,e);o.innerHTML=t,window.setTimeout((()=>{$(".loader-loaded").css("display","none")}),500)}})}})}),1e3)}}()}})();